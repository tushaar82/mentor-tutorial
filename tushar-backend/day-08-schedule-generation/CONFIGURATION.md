# Configuration Guide for Day 8: Schedule Generation

## Overview

This guide covers manual configuration steps needed for the schedule generation system. Most code is generated by AI, but you need to configure Gemini API access, create weightage data files, and set up Firestore collections.

**Time Estimate**: 30 minutes

---

## Step 1: Verify Gemini API Access

### What You're Doing
Confirming Gemini API is enabled and accessible (should already be done from Day 5 and Day 7).

### Why This Matters
Schedule generation uses Gemini Flash to create personalized study plans.

### Command/Action
```bash
# Test Gemini API access
python3 -c "
import google.generativeai as genai
import os
genai.configure(api_key=os.getenv('GEMINI_API_KEY'))
model = genai.GenerativeModel('gemini-1.5-flash')
response = model.generate_content('Hello')
print('Gemini API working:', response.text[:50])
"
```

### Expected Output
```
Gemini API working: Hello! How can I help you today?
```

### If It Fails
- **Error: "API key not found"**
  - Check `.env` file has `GEMINI_API_KEY=your_key_here`
  - Reload environment: `source .env` or restart terminal

- **Error: "API not enabled"**
  - Go to: https://console.cloud.google.com/apis/library/generativelanguage.googleapis.com
  - Click "Enable"
  - Wait 2-3 minutes for activation

---

## Step 2: Create Syllabus Weightage Data Files

### What You're Doing
Creating JSON files with topic weightages for JEE and NEET exams.

### Why This Matters
Priority calculation needs accurate weightages to rank topics correctly.

### Action
Create three weightage files with exam-specific topic percentages.

**File 1**: `tushar-backend/data/weightages/jee_main_weightages.json`
```json
{
  "exam_type": "JEE_MAIN",
  "total_marks": 300,
  "subjects": {
    "Physics": {
      "total_weightage": 33.33,
      "topics": {
        "Mechanics": 15.0,
        "Thermodynamics": 8.0,
        "Electromagnetism": 12.0,
        "Optics": 8.0,
        "Modern Physics": 10.0,
        "Waves": 8.0,
        "Rotational Motion": 7.0,
        "Gravitation": 5.0,
        "Fluid Mechanics": 5.0,
        "Properties of Matter": 5.0,
        "Heat Transfer": 5.0,
        "Oscillations": 5.0
      }
    },
    "Chemistry": {
      "total_weightage": 33.33,
      "topics": {
        "Physical Chemistry": 25.0,
        "Organic Chemistry": 30.0,
        "Inorganic Chemistry": 25.0,
        "Chemical Bonding": 8.0,
        "Thermodynamics": 7.0,
        "Equilibrium": 7.0,
        "Electrochemistry": 6.0,
        "Coordination Compounds": 5.0,
        "Hydrocarbons": 8.0,
        "Alcohols and Ethers": 6.0
      }
    },
    "Mathematics": {
      "total_weightage": 33.33,
      "topics": {
        "Calculus": 25.0,
        "Algebra": 20.0,
        "Coordinate Geometry": 15.0,
        "Trigonometry": 10.0,
        "Vectors": 8.0,
        "3D Geometry": 7.0,
        "Probability": 7.0,
        "Statistics": 5.0,
        "Matrices": 5.0,
        "Differential Equations": 5.0
      }
    }
  }
}
```

**File 2**: `tushar-backend/data/weightages/jee_advanced_weightages.json`
```json
{
  "exam_type": "JEE_ADVANCED",
  "total_marks": 360,
  "subjects": {
    "Physics": {
      "total_weightage": 33.33,
      "topics": {
        "Mechanics": 18.0,
        "Electromagnetism": 15.0,
        "Modern Physics": 12.0,
        "Thermodynamics": 10.0,
        "Optics": 10.0,
        "Waves": 8.0,
        "Rotational Motion": 8.0,
        "Fluid Mechanics": 6.0,
        "Gravitation": 5.0,
        "Properties of Matter": 4.0,
        "Heat Transfer": 4.0
      }
    },
    "Chemistry": {
      "total_weightage": 33.33,
      "topics": {
        "Organic Chemistry": 35.0,
        "Physical Chemistry": 30.0,
        "Inorganic Chemistry": 25.0,
        "Chemical Bonding": 8.0,
        "Thermodynamics": 8.0,
        "Equilibrium": 7.0,
        "Electrochemistry": 7.0,
        "Coordination Compounds": 6.0,
        "Hydrocarbons": 10.0,
        "Alcohols and Ethers": 7.0
      }
    },
    "Mathematics": {
      "total_weightage": 33.33,
      "topics": {
        "Calculus": 30.0,
        "Algebra": 22.0,
        "Coordinate Geometry": 18.0,
        "Vectors": 10.0,
        "3D Geometry": 8.0,
        "Trigonometry": 7.0,
        "Probability": 5.0,
        "Matrices": 5.0,
        "Differential Equations": 5.0
      }
    }
  }
}
```

**File 3**: `tushar-backend/data/weightages/neet_weightages.json`
```json
{
  "exam_type": "NEET",
  "total_marks": 720,
  "subjects": {
    "Physics": {
      "total_weightage": 25.0,
      "topics": {
        "Mechanics": 20.0,
        "Thermodynamics": 10.0,
        "Electromagnetism": 18.0,
        "Optics": 12.0,
        "Modern Physics": 15.0,
        "Waves": 10.0,
        "Current Electricity": 8.0,
        "Magnetism": 7.0
      }
    },
    "Chemistry": {
      "total_weightage": 25.0,
      "topics": {
        "Organic Chemistry": 35.0,
        "Physical Chemistry": 30.0,
        "Inorganic Chemistry": 25.0,
        "Chemical Bonding": 8.0,
        "Thermodynamics": 7.0,
        "Equilibrium": 7.0,
        "Electrochemistry": 6.0,
        "Coordination Compounds": 5.0,
        "Biomolecules": 8.0,
        "Polymers": 5.0
      }
    },
    "Biology": {
      "total_weightage": 50.0,
      "topics": {
        "Human Physiology": 20.0,
        "Genetics": 15.0,
        "Ecology": 12.0,
        "Plant Physiology": 12.0,
        "Cell Biology": 10.0,
        "Reproduction": 10.0,
        "Evolution": 8.0,
        "Biotechnology": 7.0,
        "Diversity": 6.0
      }
    }
  }
}
```

### Verification
```bash
# Check files exist and are valid JSON
python3 -c "
import json
files = [
    'data/weightages/jee_main_weightages.json',
    'data/weightages/jee_advanced_weightages.json',
    'data/weightages/neet_weightages.json'
]
for f in files:
    with open(f) as file:
        data = json.load(file)
        print(f'{f}: ✓ Valid ({data[\"exam_type\"]})')
"
```

### Expected Output
```
data/weightages/jee_main_weightages.json: ✓ Valid (JEE_MAIN)
data/weightages/jee_advanced_weightages.json: ✓ Valid (JEE_ADVANCED)
data/weightages/neet_weightages.json: ✓ Valid (NEET)
```

---

## Step 3: Create Firestore Collections

### What You're Doing
Setting up Firestore collections for schedules and progress tracking.

### Why This Matters
Schedules and progress data need to be stored and retrieved efficiently.

### Action
Collections will be created automatically when first schedule is generated, but you can verify structure:

**Collection: `schedules`**
- Document ID: `schedule_id` (auto-generated)
- Fields:
  - `student_id`: string
  - `analytics_id`: string
  - `exam_type`: string
  - `exam_date`: timestamp
  - `generated_date`: timestamp
  - `total_days`: number
  - `daily_study_hours`: number
  - `status`: string ("active", "completed", "abandoned")
  - `days`: array of objects
  - `revision_days`: array of numbers
  - `practice_test_days`: array of numbers
  - `priority_topics`: array of objects

**Subcollection: `schedules/{schedule_id}/progress`**
- Document ID: `day_{day_number}`
- Fields:
  - `day_number`: number
  - `date`: timestamp
  - `status`: string
  - `topics_completed`: array of objects
  - `total_time_spent`: number
  - `completion_percentage`: number

### Verification
Collections will be created automatically. No manual action needed.

---

## Step 4: Create Sample Data for Testing

### What You're Doing
Creating sample analytics and schedule data for standalone testing.

### Why This Matters
You can test schedule generation without depending on Day 7 analytics.

### Action
Create sample analytics file:

**File**: `tushar-backend/data/sample_schedules/sample_analytics_input.json`
```json
{
  "analytics_id": "analytics_sample_001",
  "student_id": "student_test_001",
  "test_id": "test_diagnostic_001",
  "exam_type": "JEE_MAIN",
  "overall_score": 520,
  "max_score": 800,
  "percentage": 65.0,
  "subject_scores": {
    "Physics": {"score": 180, "max": 240, "percentage": 75.0},
    "Chemistry": {"score": 160, "max": 240, "percentage": 66.7},
    "Mathematics": {"score": 180, "max": 320, "percentage": 56.3}
  },
  "topic_performance": [
    {"topic": "Mechanics", "subject": "Physics", "accuracy": 80.0, "questions": 10},
    {"topic": "Thermodynamics", "subject": "Physics", "accuracy": 40.0, "questions": 10},
    {"topic": "Electromagnetism", "subject": "Physics", "accuracy": 70.0, "questions": 12},
    {"topic": "Organic Chemistry", "subject": "Chemistry", "accuracy": 45.0, "questions": 15},
    {"topic": "Physical Chemistry", "subject": "Chemistry", "accuracy": 75.0, "questions": 12},
    {"topic": "Inorganic Chemistry", "subject": "Chemistry", "accuracy": 65.0, "questions": 13},
    {"topic": "Calculus", "subject": "Mathematics", "accuracy": 50.0, "questions": 20},
    {"topic": "Algebra", "subject": "Mathematics", "accuracy": 85.0, "questions": 15},
    {"topic": "Coordinate Geometry", "subject": "Mathematics", "accuracy": 55.0, "questions": 12}
  ],
  "strengths": ["Mechanics", "Algebra", "Physical Chemistry"],
  "weaknesses": ["Thermodynamics", "Organic Chemistry", "Calculus"]
}
```

### Verification
```bash
# Verify sample data is valid JSON
python3 -c "
import json
with open('data/sample_schedules/sample_analytics_input.json') as f:
    data = json.load(f)
    print(f'Sample analytics: ✓ Valid')
    print(f'Student: {data[\"student_id\"]}')
    print(f'Exam: {data[\"exam_type\"]}')
    print(f'Score: {data[\"overall_score\"]}/{data[\"max_score\"]}')
"
```

---

## Step 5: Test Priority Calculation

### What You're Doing
Testing priority calculator with sample data.

### Why This Matters
Ensures priority calculation works before full schedule generation.

### Command/Action
```bash
# Test priority calculator
python3 -c "
from services.priority_calculator import calculate_priority_score, rank_topics
import json

# Load sample analytics
with open('data/sample_schedules/sample_analytics_input.json') as f:
    analytics = json.load(f)

# Load weightages
with open('data/weightages/jee_main_weightages.json') as f:
    weightages = json.load(f)

# Test priority calculation
topic = 'Thermodynamics'
accuracy = 40.0
weightage = 8.0
difficulty = 1.0

score = calculate_priority_score(topic, accuracy, weightage, difficulty)
print(f'Priority Score for {topic}: {score}')
print(f'Formula: {weightage} × (100 - {accuracy}) × {difficulty} = {score}')
print('Expected: 480.0')
"
```

### Expected Output
```
Priority Score for Thermodynamics: 480.0
Formula: 8.0 × (100 - 40.0) × 1.0 = 480.0
Expected: 480.0
```

---

## Step 6: Update Environment Variables

### What You're Doing
Ensuring all required environment variables are set.

### Why This Matters
Schedule service needs access to Gemini API and Firestore.

### Action
Check `.env` file has these variables:
```bash
# Required from previous days
GEMINI_API_KEY=your_gemini_api_key_here
GOOGLE_APPLICATION_CREDENTIALS=path/to/service-account-key.json
FIREBASE_PROJECT_ID=your_project_id

# Optional for schedule generation
SCHEDULE_MAX_DAILY_HOURS=5.0
SCHEDULE_REVISION_PERCENTAGE=0.1
SCHEDULE_PRACTICE_TEST_INTERVAL=7
```

### Verification
```bash
# Check environment variables
python3 -c "
import os
required = ['GEMINI_API_KEY', 'GOOGLE_APPLICATION_CREDENTIALS', 'FIREBASE_PROJECT_ID']
for var in required:
    value = os.getenv(var)
    if value:
        print(f'{var}: ✓ Set')
    else:
        print(f'{var}: ✗ Missing')
"
```

---

## Configuration Complete!

You've successfully configured:
- ✅ Gemini API access verified
- ✅ Syllabus weightage data files created
- ✅ Firestore collections structure defined
- ✅ Sample test data created
- ✅ Priority calculation tested
- ✅ Environment variables verified

**Next Steps:**
1. Open **TESTING.md** to test schedule generation
2. Generate your first personalized study schedule
3. Verify adaptive rescheduling works

Ready to test? Open **TESTING.md** next!
